<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>    
    <title>DeepAR</title>
    <style>

      canvas.deepar { 
        border: 0px none; 
        background-color: black; 
        display: block; 
        margin: auto; 
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }

      body {
        margin: 0px;
        padding: 0px;        
      }


      #loader-wrapper {
        position: fixed;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        background-color: #fff;
        text-align: center;
      }

      .loader {

        display: inline-block;
        position: relative;
        top: 42%;
        z-index: 1000;

        width: 90px;
        height: 90px;
        margin: auto;
        background-color: #00f;

        border-radius: 100%;  
        -webkit-animation: sk-scaleout 1.5s infinite ease-in-out;
        animation: sk-scaleout 1.5s infinite ease-in-out;
      }

      @-webkit-keyframes sk-scaleout {
        0% { -webkit-transform: scale(0) }
        100% {
          -webkit-transform: scale(1.0);
          opacity: 0;
        }
      }

      @keyframes sk-scaleout {
        0% { 
          -webkit-transform: scale(0);
          transform: scale(0);
        } 100% {
          -webkit-transform: scale(1.0);
          transform: scale(1.0);
          opacity: 0;
        }
      }

      .control-buttons {
        position: fixed;
        top: 0px;
        left: 0px;
        width: 200px;
        height: 500px;
      }

      .control-buttons > button {
        width: 200px;
        height: 50px;
      }

      .load_img_description {
        font-family: Arial, Helvetica, sans-serif;
      }

    </style>

  </head>
  <body>

    <canvas class="deepar" id="deepar-canvas" oncontextmenu="event.preventDefault()"></canvas>
    <div id="loader-wrapper">
      <h3 class="load_img_description">Load image from the left menu and apply some effects</h3>
      <span class="loader"></span>
    </div>

    <div class="control-buttons">
      <input type="file"
       id="avatar" name="avatar"
       accept="image/png, image/jpeg"
       onchange="loadFile(event)">

      <button id="apply-makeup-look-1">Apply makeup look 1</button>
      <button id="apply-makeup-look-2">Apply makeup look 2</button>

      <button id="remove-makeup-filter">Remove makeup filter</button>

      <button id="download-photo">Download photo</button>

      <button id="redirect-video">Go to video</button>

      <img id="output" style="visibility: hidden;" />	

    </div>

    <script type="text/javascript" src="lib/deepar.js"></script>
    <script type="text/javascript">

      var canvasHeight = window.innerHeight;
      var canvasWidth = window.innerWidth;
      
      // desktop, the width of the canvas is 0.66 * window height and on mobile it's fullscreen
      if (window.innerWidth > window.innerHeight) {
        canvasWidth = Math.floor(window.innerHeight*0.66);
      }

      var deepAR = DeepAR({ 
        canvasWidth: canvasWidth, 
        canvasHeight: canvasHeight,
        licenseKey: '44601e5b2e17bc6fbd6c478a380099b9c76948d4c7d7711aef214d1d13f9f2b57b44ab004e239109',
        canvas: document.getElementById('deepar-canvas'),
        numberOfFaces: 1,
        onInitialize: function() {

        },

        onScreenshotTaken: function(photo) {
          var a = document.createElement('a');
          a.href = photo;
          a.download = 'photo.png';
          document.body.appendChild(a);
          a.click();
        }
      });



      deepAR.onVideoStarted = function() {
        var loaderWrapper = document.getElementById('loader-wrapper');
        loaderWrapper.style.display = 'none';
      };

      deepAR.downloadFaceTrackingModel('lib/models-68-extreme.bin');

      var image = new Image();

      function processPhoto(url) {

        // show loading animation
        var loaderWrapper = document.getElementById('loader-wrapper');
        loaderWrapper.style.display = 'block';

        // load image from url
        image.src = url;

        image.onload = function() {
          deepAR.processImage(image);
          // hide the loading animation
          var loaderWrapper = document.getElementById('loader-wrapper');
          loaderWrapper.style.display = 'none';
        }
      }

      function loadFile(event) {
        processPhoto(URL.createObjectURL(event.target.files[0]));              
      }

      document.getElementById('apply-makeup-look-1').onclick = function() {
        // load filter         
        deepAR.switchEffect(0, 'makeup', './effects/look1', function() {
          // effect loaded, reprocess the image
          deepAR.processImage(image);
        });
      }
      document.getElementById('apply-makeup-look-2').onclick = function() {
        // load filter         
        deepAR.switchEffect(0, 'makeup', './effects/look2', function() {
          // effect loaded, reprocess the image
          deepAR.processImage(image);
        });
      }
      document.getElementById('remove-makeup-filter').onclick = function() {
        // unload filter
        deepAR.clearEffect('makeup');
        // effect unloaded, reprocess the image
        deepAR.processImage(image);
      }
      document.getElementById('download-photo').onclick = function() {
        deepAR.takeScreenshot();
      }

      document.getElementById('redirect-video').onclick = function() {
        location.href = 'video.html';
      }
     
    </script>
  </body>
</html>
